<!DOCTYPE html>
<html>
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="app.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />


    <script src="jquery.js"></script>
    <title>LED Lamp</title>

    <script>
        $(document).ready(function () {
            let canvas = document.getElementById('picker');
            let ctx = canvas.getContext('2d');

            let image = new Image();
            image.onload = function () {
                ctx.drawImage(image, 0, 0, image.width, image.height);
            };
            image.src = "colorpicker.png";

            function process(d) {
                $('.switch input').prop('checked', d.front.on);
                $('#brightness').prop('value', d.front.brightness);
                $('#effect').prop('value', d.front.effect);
            }

            function send(t, m) {
                $.ajax({
                    url: "cmd?t=" + t + "&m=" + m,
                    turl: "test.json",
                    cache: false,
                    dataType: "json",
                    success: function (d) {
                        process(d);
                        $('#error').text('');
                        console.log('Sent');
                    },
                    error: function (d) {
                        $('#error').text('Disconnected');
                        console.log('Error', d);
                    },
                    timeout: 3000
                });
            }

            $('#picker').click(function (e) {
                let canvasOffset = $(canvas).offset();
                let canvasX = Math.floor(e.pageX - canvasOffset.left);
                let canvasY = Math.floor(e.pageY - canvasOffset.top);

                let imageData = ctx.getImageData(canvasX, canvasY, 1, 1);
                let pixel = imageData.data;
                let pixelColor = pixel[0] + "," + pixel[1] + "," + pixel[2];
                $('.preview').css('backgroundColor', pixelColor);

                console.log('Color: ' + pixelColor);
                send("/all/rgb", pixelColor);
            });

            $('.switch input').click(function (e) {
                 let on = $('.switch input').prop('checked');
                 send("/all", on ? "on" : "off");
                console.log(on ? 'Turned on' : 'Turned off');

                let bc = $('#brightness');
                if (on && bc.prop('value') === '0') {
                    bc.prop('value', '64');
                    send("/all/brightness", bc.prop('value'));
                }
            });

            $('#brightness').change(function (e) {
                let b = this.value;
                send("/all/brightness", b);
                console.log('Brightness: ', b);
            });

            $('#effect').change(function (e) {
                let f = this.value;
                send("/all/effect", f);
                console.log('Effect: ', f);
            });

            send("get", "status");
            setInterval(function () { send("get", "status"); }, 5000);
        });
    </script>

    <style>
        .noshadow * {
            -webkit-box-shadow: none !important;
            -moz-box-shadow: none !important;
            box-shadow: none !important;
            -webkit-user-select: none !important;
        }

        .ui-content {
            margin-top: 32px;
            text-align: center;
        }

        #error {
            font-family: Arial, Helvetica, Sans-Serif, serif;
            height: 24px;
            color: #a00;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .2s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .2s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        .brightnesscontainer {
            position: relative;
            display: inline-block;
            width: 300px;
        }

        .brightness {
            -webkit-appearance: none;
            width: 300px;
            height: 15px;
            border-radius: 5px;
            background: #ccc;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .brightness::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #2196F3;
            cursor: pointer;
        }

        .brightness::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #2196F3;
            cursor: pointer;
        }

        .effectcontainer {
            position: relative;
            display: inline-block;
            width: 300px;
        }


        .btn-group button {
            background-color: #ccc; /* Green background */
            border: 1px solid #2196F3; /* Green border */
            color: white; /* White text */
            padding: 10px 24px; /* Some padding */
            cursor: pointer; /* Pointer/hand icon */
            float: left; /* Float the buttons side by side */
        }

        .btn-group button:not(:last-child) {
            border-right: none; /* Prevent double borders */
        }

        /* Clear floats (clearfix hack) */
        .btn-group:after {
            content: "";
            clear: both;
            display: table;
        }

        /* Add a background color on hover */
        .btn-group button:hover {
            background-color: #2196F3;
        }
    </style>
</head>
<body>
<div data-role="page" class="noshadow">
    <div data-role="main" class="ui-content">
        <p>
        <div id="error"></div>
        <p>
        <label class="switch">
            <input type="checkbox">
            <span class="slider round"></span>
        </label>
        <p>
        <!--div class="btn-group">
            <button type="button" class="btn btn-primary">All</button>
            <button type="button" class="btn btn-primary">Front</button>
            <button type="button" class="btn btn-primary">Back</button>
        </div-->
        <p>
        <div class="effectcontainer">
            <select id="effect">
                <option value="none" selected>-- Select Effect --</option>
                <option value="random">Cycle Effects Randomly</option>
                <option value="glitter">Glitter</option>
                <option value="confetti">Confetti</option>
                <option value="cycle">Slow Cycle</option>
                <option value="fire">Fire</option>
                <option value="bpm">Beats</option>
                <option value="juggle">Juggle</option>
                <option value="sinelon">Particle</option>
                <option value="rainbow">Rainbow</option>
                <option value="rainbowWithGlitter">Rainbbow With Glitter</option>
                <option value="test">Test Pattern</option>
            </select>
        </div>
        <p>
        <canvas id="picker" var="1" width="290" height="290"></canvas>
        <p>
        <div class="brightnesscontainer">
            <input type="range" min="0" max="255" value="0" class="brightness" id="brightness">
        </div>
    </div>
</div>
</body>
</html>

